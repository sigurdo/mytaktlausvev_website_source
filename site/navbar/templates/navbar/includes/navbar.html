<nav class="navbar p-1 navbar-expand-xl fixed-top navbar-dark {% if not DEBUG %} bg-primary {% else %}" style="background-color:#058104; {% endif %}">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"/>
            {% load static %}
            <img class="w-14 me-2" src="{% static 'images/logo_flag.svg' %}">
            <span class="d-none d-sm-inline fw-bold">Studentorchesteret Dei Taktlause</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsable"
            aria-controls="collapsable" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="collapsable">
            <ul class="navbar-nav navbar-nav-scroll me-auto" style="--bs-scroll-height: 65vh;">
                {% for item in navbar_items %}
                    <li class="nav-item dropdown">
                        <a class="
                            nav-link
                            {% if item.is_active %} active {% endif %}
                            {% if item.is_dropdown %} dropdown-toggle {% endif %}
                            "
                            href="{{item.href}}"
                            {% if item.is_dropdown %}
                                id="dropdown-button-{{item.pk}}"
                                role="button"
                                data-bs-toggle="dropdown"
                                {% if item.is_active %}
                                    aria-expanded="true"
                                {% else %}
                                    aria-expanded="false"
                                {% endif %}
                            {% endif %}>
                            {{item.text}}
                        </a>
                        {% if item.is_dropdown %}
                            <ul class="dropdown-menu navbar-dropdown-menu" aria-labelledby="dropdown-button-{{item.pk}}">
                                {% for sub_item in item.sub_items_annotated %}
                                    <li class="nav-item">
                                        <a class="
                                            dropdown-item
                                            nav-link
                                            bg-reset
                                            p-2
                                            {% if sub_item.is_active %}active{% endif %}
                                            "
                                            href="{{sub_item.link}}">
                                            {{sub_item.text}}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
            <ul class="nav navbar-nav">
                <li class="nav-item dropdown">
                    {% if user.is_authenticated %}
                        <a class="
                                nav-link
                                dropdown-toggle
                                text-decoration-none
                                "
                            href="/brygg/"
                            id="dropdown-button-profile"
                            role="button"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            >
                            <img
                                src="{{ user.get_avatar_url }}"
                                class="object-fit-cover w-10 h-10 rounded-circle border border-2 border-white"
                            />
                        </a>
                        <ul class="dropdown-menu navbar-dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-button-profile">
                            <li class="nav-item">
                                <a class="
                                    dropdown-item
                                    nav-link
                                    bg-reset
                                    p-2
                                    "
                                    href="{{ user.get_absolute_url }}">
                                    <div class="fw-bold">{{ user }}</div>
                                    <div class="text-decoration-none">
                                        {% if user.instrument_type %}
                                            {{ user.instrument_type }}
                                        {% else %}
                                            Inga instrumentgruppe
                                        {% endif %}
                                    </div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="
                                    dropdown-item
                                    nav-link
                                    bg-reset
                                    p-2
                                    {% if user.get_edit_url == request_path %} active {% endif %}
                                    "
                                    href="{{ user.get_edit_url }}">
                                    Rediger profil
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="
                                    dropdown-item
                                    nav-link
                                    bg-reset
                                    p-2
                                    "
                                    href="{% url 'logout' %}?next=/">
                                    <button class="btn btn-sm btn-danger">
                                        Logg ut
                                    </button>
                                </a>
                            </li>
                        </ul>
                    {% else %}
                       <a class="
                                nav-link
                                dropdown-toggle
                                text-decoration-none
                                "
                            href="/brygg/"
                            id="dropdown-button-login"
                            role="button"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            >
                            Logg inn
                        </a>
                        <div class="dropdown-menu p-3 dropdown-menu-end" aria-labelledby="dropdown-button-login">
                            {% load crispy_forms_tags %}
                            {% crispy form_login %}
                            <a href="{% url 'password_reset' %}">Be om nytt passord</a>
                        </div>
                    {% endif %}
                </li>
            </ul>
        </div>
    </div>
</nav>
